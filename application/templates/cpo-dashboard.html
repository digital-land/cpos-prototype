{% extends "dlf-base.html" %}

{% block content %}

	<span class="govuk-caption-xl">Summary data</span>
    <h1 class="govuk-heading-xl">
      Compulsory purchase orders
    </h1>

	<div class="govuk-grid-row">
		<div class="govuk-grid-column-one-half">
			<div class="data-item govuk-!-margin-bottom-6">
				<span class="data-item__number govuk-!-font-size-80">{{ by_year.counts[-1][1] }}</span>
				<p class="govuk-body govuk-!-font-size-36">Total (this year)</p>
				<span><a href="{{ url_for('frontend.cpo_list', year=2019) }}" class="govuk-link">See CPOs for 2019</a></span>
			</div>
		</div>
		<div class="govuk-grid-column-one-half">
			<div class="data-item govuk-!-margin-bottom-6">
				<span class="data-item__number govuk-!-font-size-80">{{ cpos | count }}</span>
				<p class="govuk-body govuk-!-font-size-36">Total (since 2012)</p>
			</div>
		</div>
	</div>

	<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">

	<h2 class="govuk-heading-m">Number of CPOs per year (last 5)</h2>

	{% set max_count = (((by_year.max/100)|round(1, 'ceil'))*100)|int %}
	{% set min_count = (((by_year.min/100)|round(1, 'floor'))*100)|int %}
	{% set difference = max_count - min_count %}
	<ul class="govuk-list">
		{% for year in by_year.counts %}
		{% set relative_value = year[1] - min_count %}
		<li>
		<div class="govuk-grid-row contribution-category-row">
		  <div class="govuk-grid-column-one-quarter">
		    <h4 class="govuk-heading-s contribution-category-heading"><a href="{{ url_for('frontend.cpo_list', year=year[0]) }}">{{ year[0] }}</a></h4>
		  </div>
		  <div class="govuk-grid-column-three-quarters contribution-bar-container">
			{% set bar_percentage = ((relative_value/difference)*65)|int %}
		    <div class="contribution-bar" style="width: {{ bar_percentage + 35 }}%;">
		      <span class="govuk-!-font-size-24 govuk-!-font-weight-bold data-item">{{ year[1] }}</span>
		    </div>
		    <div class="govuk-!-font-size-24 data-item cb-floating-figure">{{ year[1] }}</div>
		  </div>
		</div>
		</li>
		{% endfor %}
	</ul>

	<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">

	<h3 class="govuk-heading-m">Lastest CPOs</h3>
	<ul class="govuk-list">
		{% for cpo in recent_cpos %}
		<li>
			<span class="govuk-tag">{{ cpo.latest_status().status }}</span>
			<a href="{{ url_for('frontend.cpo', id=cpo.compulsory_purchase_order) }}">{{ cpo.compulsory_purchase_order }}</a>, 
			<span>{{ cpo.name }}</span>
        </li>
		{% endfor %}
	</ul>

	<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">

	<h2 class="govuk-heading-l">Local authorities with most CPOs</h2>

	<h3 class="govuk-heading-m">2019</h3>
	<ul class="govuk-list">
		{% set max_val = (((top_orgs_2019|flatten_tuples(1)|max)/100)|round(1, 'ceil'))*100 %}
		{% set min_val = (((top_orgs_2019|flatten_tuples(1)|min)/100)|round(1, 'floor'))*100 %}
		{% set difference = max_val - min_val %}

		{% for org in top_orgs_2019 %}
		{% set relative_value = org[1] - min_val %}
		<li>
			<div class="govuk-grid-row contribution-category-row">
			  <div class="govuk-grid-column-one-third">
			    <h4 class="govuk-heading-s contribution-category-heading"><a href="{{ url_for('frontend.cpo_list', year=2019, org=org[0]) }}">{{ org[0] | map_la_code_to_name }}</a></h4>
			  </div>
			  <div class="govuk-grid-column-two-thirds contribution-bar-container">
				{% set bar_percentage = ((relative_value/difference)*99)|int %}
			    <div class="contribution-bar" style="width: {{ bar_percentage + 1 }}%;">
			      <span class="govuk-!-font-size-24 govuk-!-font-weight-bold data-item">{{ org[1] }}</span>
			    </div>
			    <div class="govuk-!-font-size-24 data-item cb-floating-figure">{{ org[1] }}</div>
			  </div>
			</div>
        </li>
		{% endfor %}
	</ul>

	<h3 class="govuk-heading-m">All time</h3>
	<ul class="govuk-list">
		{% set max_val = (((top_orgs|flatten_tuples(1)|max)/100)|round(1, 'ceil'))*100 %}
		{% set min_val = (((top_orgs|flatten_tuples(1)|min)/100)|round(1, 'floor'))*100 %}
		{% set difference = max_val - min_val %}

		{% for org in top_orgs %}
		{% set relative_value = org[1] - min_val %}
		<li>
			<div class="govuk-grid-row contribution-category-row">
			  <div class="govuk-grid-column-one-third">
			    <h4 class="govuk-heading-s contribution-category-heading"><a href="{{ url_for('frontend.cpo_list', org=org[0]) }}">{{ org[0] | map_la_code_to_name }}</a></h4>
			  </div>
			  <div class="govuk-grid-column-two-thirds contribution-bar-container">
				{% set bar_percentage = ((relative_value/difference)*70)|int %}
			    <div class="contribution-bar" style="width: {{ bar_percentage + 30 }}%;">
			      <span class="govuk-!-font-size-24 govuk-!-font-weight-bold data-item">{{ org[1] }}</span>
			    </div>
			    <div class="govuk-!-font-size-24 data-item cb-floating-figure">{{ org[1] }}</div>
			  </div>
			</div>
        </li>
		{% endfor %}
	</ul>
    

{% endblock %}
